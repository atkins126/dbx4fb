<?xml version="1.0" encoding="ISO-8859-1"?>

<project name="DBX Test Cases" default="build" basedir=".">

	<taskdef resource="net/sf/antcontrib/antlib.xml"/>
	
	<property environment="env" />
	<property name="program.conf" location="dbxfbTests.ini" />
	
	<target name="dbx.test">
		<tempfile property="p.script" destdir="${env.TEMP}" suffix=".cmd"/>

		<condition property="p.platform" value="" else="win32">
			<equals arg1="${p.tag.program}" arg2="d11" />
		</condition>

		<condition property="p.config" value="" else="release">
			<equals arg1="${p.tag.program}" arg2="d11" />
		</condition>

		<property name="program" location="${env.HOMEDRIVE}${env.HOMEPATH}\Project\output.${p.tag.program}\moon\${p.platform}\${p.config}\dbxfbTests.exe" />

		<echo file="${p.script}">
			${program} -config ${program.conf} -drivers ${env.HOMEDRIVE}${env.HOMEPATH}\project\output.d11\moon\drivers -test ${test} -console
		</echo>

		<exec executable="cmd" spawn="false">
			<arg line="/c ${p.script}" />
		</exec>

		<delete file="${p.script}" />
	</target>

	<target name="build">
		<echo message="1. DBX 4 Firebird driver for Delphi 2007" />
		<echo message="2. DBX 4 Firebird driver for Delphi 2009" />
		<echo message="3. DBX 4 Firebird driver for Delphi 2010" />
		<echo message="4. DBX 4 Firebird driver for Delphi XE" />
		<echo message="5. DBX 4 Firebird driver for Delphi XE2" />
		<echo message="9. Exit" />
		<echo />
		<input message="Please choose option to ant:" validargs="1,2,3,4,5,9" addproperty="p.option" defaultvalue="1" />

		<antcall target="t.execute"/>
	</target>

	<target name="t.execute" depends="t.option" unless="p.option.exit">
		<for param="i" begin="1" end="14" parallel="true" threadCount="1">
			<sequential>
				<antcall target="dbx.test">
					<param name="test" value="embedded_@{i}" />
				</antcall>
			</sequential>
		</for>

		<for param="i" begin="1" end="5" parallel="true" threadCount="1">
			<sequential>
				<antcall target="dbx.test">
					<param name="test" value="server_@{i}" />
				</antcall>
			</sequential>
		</for>
	</target>

	<target name="t.option">
		<condition property="p.tag.program" value="d11">
			<equals arg1="${p.option}" arg2="1" />
		</condition>

		<condition property="p.tag.program" value="d12">
			<equals arg1="${p.option}" arg2="2" />
		</condition>

		<condition property="p.tag.program" value="d14">
			<equals arg1="${p.option}" arg2="3" />
		</condition>

		<condition property="p.tag.program" value="d15">
			<equals arg1="${p.option}" arg2="4" />
		</condition>

		<condition property="p.tag.program" value="d16">
			<equals arg1="${p.option}" arg2="5" />
		</condition>

		<condition property="p.option.exit">
			<equals arg1="${p.option}" arg2="9" />
		</condition>
	</target>
</project>
